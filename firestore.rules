rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if the user is the admin
    function isAdmin() {
      return request.auth != null && request.auth.email == 'harshsharmaqa@gmail.com';
    }

    // Helper function to check if the user is the owner of the document
    function isOwner(userId) {
      return request.auth != null && request.auth.uid == userId;
    }

    // Users can be created by anyone (on signup)
    // Users can only be read or written to by themselves or an admin.
    // Admins can list all users for the dashboard.
    match /users/{userId} {
      allow create;
      allow read, write: if isOwner(userId) || isAdmin();
      allow list: if isAdmin();
    }

    // Blogs can be read by anyone.
    // Writes are restricted to admins.
    match /blogs/{blogId} {
      allow read;
      allow write: if isAdmin();

      // Likes can be read by anyone.
      // A user can only create or delete their own like.
      match /likes/{userId} {
        allow read;
        allow create, delete: if isOwner(userId);
      }
    }

    // Courses, testimonials, pages, and site settings can be read by anyone.
    // Writes are restricted to admins.
    match /courses/{courseId} {
      allow read;
      allow write: if isAdmin();
    }

    match /testimonials/{testimonialId} {
      allow read;
      allow write: if isAdmin();
    }

    match /pages/{pageId} {
      allow read;
      allow write: if isAdmin();
    }

    match /settings/site {
      allow read;
      allow write: if isAdmin();
    }
  }
}
