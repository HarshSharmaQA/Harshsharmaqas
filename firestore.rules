
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper functions
    function isUser(uid) {
      return request.auth.uid == uid;
    }

    // PUBLIC: Allow anyone to read blogs, pages, courses and testimonials.
    match /blogs/{blogId} {
      allow read;

      // Likes can be read by anyone, but only modified by the owner.
      match /likes/{uid} {
        allow read;
        allow write: if isUser(uid);
      }
    }
    match /pages/{pageId} {
      allow read;
    }
    match /courses/{courseId} {
      allow read;
    }
    match /testimonials/{testimonialId} {
      allow read;
    }
    
    // SITE: Only admins can write to site settings, anyone can read.
    match /settings/site {
        allow read;
    }

    // USERS: A user can be created on signup, but only the user can read/write their own document.
    match /users/{uid} {
      allow create, read, update, delete: if isUser(uid);
    }
  }
}
