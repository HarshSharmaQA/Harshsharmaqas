
rules_version = '2';

// The admin UID. All admin actions will be checked against this UID.
// Replace this with the actual UID of harshsharmaqa@gmail.com after they sign up.
function adminUid() {
  return "7YCygdl3aITdlmgRHqBrZCzuWcj1";
}

function isAuth() {
  return request.auth != null;
}

function isUser(uid) {
  return isAuth() && request.auth.uid == uid;
}

function isAdmin() {
  return isAuth() && request.auth.uid == adminUid();
}

service cloud.firestore {
  match /databases/{database}/documents {

    // Admins can read/write any user document.
    // A user can read/write their own user document, but cannot change their own role.
    match /users/{uid} {
      allow list: if isAdmin();
      allow read: if isUser(uid) || isAdmin();
      // Allow create for anyone (for signup)
      allow create: if isAuth(); 
      // Allow user to update their own info, but not role. Admin can update anything.
      allow update: if (isUser(uid) && !('role' in request.resource.data)) || isAdmin();
      // Only admin can delete users
      allow delete: if isAdmin();
    }

    // Blogs can be read by anyone.
    // Only admins can create, update, or delete blogs.
    match /blogs/{blogId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Courses can be read by anyone.
    // Only admins can create, update, or delete courses.
    match /courses/{courseId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    // Custom Pages can be read by anyone.
    // Only admins can create, update, or delete pages.
    match /pages/{pageId} {
       allow read: if true;
       allow write: if isAdmin();
    }

    // Testimonials can be read by anyone.
    // Only admins can create, update, or delete testimonials.
    match /testimonials/{testimonialId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Site settings can be read by anyone.
    // Only admins can change site settings.
    match /settings/site {
      allow read: if true;
      allow write: if isAdmin();
    }
  }
}
